# ğŸ’¼ SystÃ¨me d'Assignation Account Manager - Documentation

## Vue d'ensemble

Le systÃ¨me permet aux **HEAD_OF_SALES** (comme Leyna) d'assigner un **Account Manager** (comme Ines) pour gÃ©rer le suivi des collaborations aprÃ¨s avoir deal avec les marques.

## ğŸ”„ Workflow Complet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£  PROSPECTION                                             â”‚
â”‚  â†’ HEAD_OF_SALES (Leyna) prospecte les marques             â”‚
â”‚  â†’ CrÃ©e des nÃ©gociations                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£  NÃ‰GOCIATION & DEAL                                      â”‚
â”‚  â†’ Leyna nÃ©gocie avec la marque                            â”‚
â”‚  â†’ Deal signÃ© â†’ Collaboration crÃ©Ã©e (statut GAGNE)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£  ASSIGNATION ACCOUNT MANAGER                            â”‚
â”‚  â†’ Leyna assigne Ines (Account Manager)                    â”‚
â”‚  â†’ Bouton "Assigner Ã  l'Account Manager"                   â”‚
â”‚  â†’ Date d'assignation enregistrÃ©e                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£  SUIVI PAR L'ACCOUNT MANAGER                            â”‚
â”‚  â†’ Ines prend en charge le suivi complet                   â”‚
â”‚  â†’ GÃ¨re la production                                       â”‚
â”‚  â†’ Suit la publication                                      â”‚
â”‚  â†’ GÃ¨re la facturation                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¥ RÃ´les et ResponsabilitÃ©s

### ğŸ‘©â€ğŸ’¼ **HEAD_OF_SALES (Leyna)**

**ResponsabilitÃ©s :**
- âœ… Prospection des marques
- âœ… NÃ©gociations
- âœ… Signature des deals
- âœ… **Assigner un Account Manager** aprÃ¨s le deal
- âœ… Vue globale de toutes les collaborations

**Ce qu'elle peut faire :**
```yaml
Collaborations:
  - CrÃ©er des collaborations
  - Assigner un Account Manager
  - Retirer un Account Manager
  - Modifier les collaborations
  - Voir toutes les collaborations

Gifts:
  - Voir toutes les demandes de gifts (lecture seule)
```

### ğŸ’¼ **ACCOUNT MANAGER (Ines - RÃ´le CM)**

**ResponsabilitÃ©s :**
- âœ… **Suivi des collaborations** assignÃ©es par Leyna
- âœ… **Gestion des gifts** pour tous les talents
- âœ… Communication avec les talents et marques
- âœ… Suivi production â†’ publication â†’ facturation

**Ce qu'elle peut faire :**
```yaml
Collaborations:
  - Voir ses collaborations assignÃ©es
  - Dashboard dÃ©diÃ© (/account-manager)
  - GÃ©rer le suivi (commentaires, updates)
  - Suivre l'avancement

Gifts:
  - Voir toutes les demandes de gifts
  - Prendre en charge les demandes
  - GÃ©rer le workflow complet
  - Contacter les marques
  - Suivre l'envoi et la rÃ©ception
```

---

## ğŸ—„ï¸ Base de DonnÃ©es

### Modifications du modÃ¨le `Collaboration`

```prisma
model Collaboration {
  // ... champs existants ...
  
  // NOUVEAU: Account Manager assignÃ©
  accountManagerId  String?
  accountManager    User?   @relation("AccountManagerCollabs", fields: [accountManagerId], references: [id])
  dateAssignationAM DateTime?
  
  // ... autres champs ...
}
```

### Modifications du modÃ¨le `User`

```prisma
model User {
  // ... champs existants ...
  
  // NOUVEAU: Collaborations gÃ©rÃ©es en tant qu'Account Manager
  collabsGerees     Collaboration[]  @relation("AccountManagerCollabs")
  
  // ... autres champs ...
}
```

---

## ğŸ”Œ API CrÃ©Ã©e

### `POST /api/collaborations/[id]/assigner-am`
**Assigner un Account Manager Ã  une collaboration**

**Permissions :** HEAD_OF_SALES, ADMIN uniquement

```typescript
// Request
{
  "accountManagerId": "user_id_ines"
}

// Response
{
  "id": "collab_id",
  "reference": "COL-2026-0123",
  "accountManagerId": "user_id_ines",
  "dateAssignationAM": "2026-01-26T...",
  "accountManager": {
    "id": "user_id_ines",
    "prenom": "Ines",
    "nom": "...",
    "email": "ines@glowup.com"
  },
  // ... autres donnÃ©es
}
```

### `DELETE /api/collaborations/[id]/assigner-am`
**Retirer l'assignation d'un Account Manager**

**Permissions :** HEAD_OF_SALES, ADMIN uniquement

### `GET /api/collaborations?accountManagerId=xxx`
**Filtrer les collaborations par Account Manager**

```typescript
// RÃ©cupÃ©rer les collaborations d'Ines
GET /api/collaborations?accountManagerId=user_id_ines
```

---

## ğŸ¨ Interfaces CrÃ©Ã©es

### 1. **Dashboard Account Manager** (`/account-manager`)

**URL :** `/account-manager`  
**AccÃ¨s :** CM (Account Manager) et ADMIN uniquement

**FonctionnalitÃ©s :**
- ğŸ“Š Stats en temps rÃ©el :
  - Total de collaborations assignÃ©es
  - Collaborations en cours
  - Collaborations publiÃ©es
  - Demandes de gifts
  - Gifts en cours de traitement

- ğŸ“‹ Liste des collaborations assignÃ©es :
  - Filtres par statut
  - Recherche par rÃ©fÃ©rence, talent ou marque
  - Vue carte avec dÃ©tails complets
  - Lien vers chaque collaboration

- ğŸ AccÃ¨s rapide aux Gifts :
  - Bouton vers la page des gifts
  - Nombre de demandes en attente

**Exemple d'affichage :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard Account Manager                   â”‚
â”‚ GÃ©rez vos collaborations et les gifts      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Stats:
â”œâ”€ Mes collaborations: 12
â”œâ”€ En cours: 5
â”œâ”€ PubliÃ©es: 3
â”œâ”€ Demandes gifts: 8
â””â”€ Gifts en cours: 4

Mes collaborations assignÃ©es:
â”œâ”€ COL-2026-0123 | Talent A | Marque X | 5,000â‚¬
â”œâ”€ COL-2026-0124 | Talent B | Marque Y | 8,000â‚¬
â””â”€ ...
```

### 2. **Bouton d'assignation** (dans la page collaboration)

Sur la page de dÃ©tails d'une collaboration (`/collaborations/[id]`), si vous Ãªtes **HEAD_OF_SALES** :

```typescript
// Ã€ ajouter dans la page de dÃ©tails
<AssignerAMButton 
  collaborationId={collab.id}
  accountManagerActuel={collab.accountManager}
  onAssign={() => refetch()}
/>
```

**Composant Ã  crÃ©er :**
- Liste dÃ©roulante des Account Managers (CM)
- Bouton "Assigner"
- Badge montrant l'AM actuel
- Bouton pour retirer l'assignation

---

## ğŸ“‹ Sidebar - Nouvelle EntrÃ©e

Dans la sidebar, nouvelle entrÃ©e :

```typescript
{
  label: "Account Manager",
  href: "/account-manager",
  icon: UserCog,
  roles: ["CM", "ADMIN"],
}
```

**Visible par :** Account Managers (CM) et Admins uniquement

---

## ğŸ” Permissions RÃ©capitulatives

| RÃ´le | CrÃ©er Collab | Assigner AM | Voir ses Collabs | GÃ©rer Gifts |
|------|-------------|-------------|-----------------|-------------|
| **HEAD_OF_SALES** | âœ… | âœ… | âœ… (toutes) | âŒ (lecture) |
| **ACCOUNT_MANAGER (CM)** | âŒ | âŒ | âœ… (assignÃ©es) | âœ… |
| **ADMIN** | âœ… | âœ… | âœ… (toutes) | âœ… |
| **TM** | âœ… | âŒ | âœ… (ses talents) | âœ… (ses demandes) |

---

## ğŸš€ Migration & DÃ©ploiement

### Ã‰tape 1 : Appliquer la migration Prisma

```bash
# GÃ©nÃ©rer le client Prisma
npx prisma generate

# Appliquer les changements
npx prisma db push
```

### Ã‰tape 2 : CrÃ©er un utilisateur Account Manager

Si Ines n'existe pas encore :

```bash
# Via Prisma Studio
npx prisma studio

# Puis crÃ©er :
email: ines@glowup.com
role: CM (Community Manager = Account Manager)
prenom: Ines
nom: [nom de famille]
actif: true
```

### Ã‰tape 3 : VÃ©rifier le rÃ´le de Leyna

```sql
-- VÃ©rifier que Leyna a le rÃ´le HEAD_OF_SALES
SELECT id, email, prenom, nom, role 
FROM users 
WHERE email = 'leyna@glowup.com';

-- Si besoin, mettre Ã  jour :
UPDATE users 
SET role = 'HEAD_OF_SALES' 
WHERE email = 'leyna@glowup.com';
```

---

## ğŸ¯ ScÃ©nario d'Utilisation Complet

### Exemple : Collaboration avec la marque "BeautyBrand"

**Jour 1 - Prospection (Leyna)**
```
1. Leyna contacte BeautyBrand
2. CrÃ©e une nÃ©gociation dans le systÃ¨me
3. NÃ©gocie les termes
```

**Jour 3 - Deal signÃ© (Leyna)**
```
4. Deal validÃ© !
5. Leyna crÃ©e la collaboration COL-2026-0150
   - Talent: Sophie Martin
   - Marque: BeautyBrand
   - Montant: 8,000â‚¬
   - Statut: GAGNE
```

**Jour 3 - Assignation (Leyna)**
```
6. Leyna va sur /collaborations/COL-2026-0150
7. Clique sur "Assigner Ã  l'Account Manager"
8. SÃ©lectionne "Ines" dans la liste
9. Valide â†’ Ines reÃ§oit la collaboration
```

**Jour 4-30 - Suivi (Ines)**
```
10. Ines voit la nouvelle collab dans son dashboard /account-manager
11. Elle contacte Sophie (le talent) pour brief
12. Suit la production du contenu
13. Valide la publication
14. GÃ¨re la facturation
15. Suit le paiement
```

**Pendant ce temps - Gifts (Ines)**
```
- ReÃ§oit 3 demandes de gifts de TMs
- Prend en charge les demandes
- Contacte les marques
- GÃ¨re les envois
- Confirme les rÃ©ceptions
```

---

## ğŸ“Š Notifications (Ã€ implÃ©menter)

### Pour Ines (Account Manager)
```
âœ‰ï¸ "Nouvelle collaboration assignÃ©e"
   â†’ COL-2026-0150 | Sophie Martin | BeautyBrand
   â†’ AssignÃ©e par Leyna

ğŸ "Nouvelle demande de gift"
   â†’ GIFT-2026-0042 | Marie Dupont | Produit X
   â†’ CrÃ©Ã©e par TM John
```

### Pour Leyna (HEAD_OF_SALES)
```
âœ… "Account Manager assignÃ©"
   â†’ Ines a Ã©tÃ© assignÃ©e Ã  COL-2026-0150

ğŸ“ "Update de collaboration"
   â†’ Ines a mis Ã  jour COL-2026-0150
   â†’ Statut: EN_COURS â†’ PUBLIE
```

---

## ğŸ”„ IntÃ©gration avec les Gifts

Les Account Managers (CM) gÃ¨rent **deux choses** :

1. **Collaborations assignÃ©es** par les HEAD_OF_SALES
   - Dashboard : `/account-manager`
   - Focus : Suivi aprÃ¨s le deal

2. **Demandes de Gifts** de tous les TM
   - Dashboard : `/gifts`
   - Focus : Obtenir des produits gratuits

**Navigation claire :**
```
/account-manager â†’ Dashboard principal
  â”œâ”€ Mes collaborations assignÃ©es
  â””â”€ Lien vers /gifts

/gifts â†’ Gestion des gifts
  â”œâ”€ Toutes les demandes
  â””â”€ Workflow complet
```

---

## âœ… Checklist de Mise en Production

- [ ] Migration Prisma appliquÃ©e
- [ ] Utilisateur Ines crÃ©Ã© avec rÃ´le CM
- [ ] Utilisateur Leyna avec rÃ´le HEAD_OF_SALES
- [ ] Page `/account-manager` accessible
- [ ] Bouton d'assignation fonctionnel sur collaborations
- [ ] API d'assignation testÃ©e
- [ ] Sidebar mise Ã  jour
- [ ] Tests avec un cas rÃ©el

---

## ğŸ“ Support & Questions

**Workflow unclear ?**
- Leyna fait la prospection et nÃ©gocie
- AprÃ¨s le deal, elle assigne Ines
- Ines prend le relais pour le suivi

**Qui gÃ¨re quoi ?**
- Prospection â†’ Leyna (HEAD_OF_SALES)
- Suivi collaboration â†’ Ines (Account Manager)
- Gifts â†’ Ines (Account Manager)

---

**CrÃ©Ã© le :** 26 janvier 2026  
**Version :** 1.0  
**Status :** âœ… Ready to Deploy

**Prochaines Ã©tapes :**
1. Appliquer la migration
2. CrÃ©er les utilisateurs
3. Tester le workflow complet
4. Former les Ã©quipes
